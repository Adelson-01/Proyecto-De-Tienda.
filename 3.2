//Yadiel, Jose, Adelson
//Programming Logic COMP 2120
//Project

#include <iostream>
#include <ctime>
#include <algorithm>
#include <cstdlib>
#include <limits>
using namespace std;

/***************************/
// OpenAI ChatGPT (2025) Generaci√≥n de funciones y manejo de entrada.
// Recuperado de: https://chat.openai.com/
/***************************/

//Gpt Generated
string to_lower(const string& str) {
	string lower_str = str;
	transform(lower_str.begin(), lower_str.end(), lower_str.begin(), ::tolower);
	return lower_str;
}

int main() {
	//YadielJose
	srand(time(0));
	float gold = rand() % 401 + 100; //random gold generator between 100 and 500
	char menu_opt;
	string opt, want;
	int buying = -1, quantity;
	string buy_opt;
	//si el usuario de vdd quiere comprar lo que marco
	string cont="yes"; //si el usuario quiere seguir comprando
	float final_price;

	//JOSE ARRAY BLOCK (IMPORTANT)
	string w_names[] = { "sword"/*0*/, "dagger"/*1*/, "javelin"/*2*/, "stick"/*3*/, "bow"/*4*/};
	float w_prices[] = { 100.0, 50.0, 75.0, 0.5, 90.0};
	int w_stock[] = { 3, 5, 2, 10, 1};
	int wstock_bought[] = {0, 0, 0, 0, 0};

	//ADELSONJOSE ARRAY BLOCK CLOTHING
	string c_names[] = {"cloak"/*0*/,"helmet"/*1*/,"medallion"/*2*/,"underwear"/*3*/,"pant"/*4*/};
	float c_prices[] = {60.0,80.0,40.0,10.0,35.0};
	int c_stock[] = {3,2,5,10,4};
	int cstock_bought[] = {0,0,0,0,0};

	//ADELSONJOSE ARRAY BLOCK POTIONS
	string p_names[] = {"strength","regeneration","stamina","invisibility"};
	float p_prices[] = {10.0,15.0,20.0,30.0};
	int p_stock[] = {5,2,6,1};
	int pstock_bought[] = {0,0,0,0};

	//ADELSONJOSE ARRAY BLOCK FOOD
	string f_names[] = {"apples","bread","soup","beef"};
	float f_prices[] = {1.0,2.0,4.0,10.0};
	int f_stock[] = {10,10,10,5};
	int fstock_bought[] = {0,0,0,0};

	srand(time(0));
	int greet = rand() % 4 + 1;
	int discount = rand() % 4 + 1;

	//Greeting
	if(greet==1) {
		cout<<"Melvin The Merchant: Hello there traveller! Welcome to Melvin's shop of pure necessities, I'm Melvin... and this is my shop... of necessities. ";
	} else if(greet==2) {
		cout<<"Melvin The Merchant: Oh, hey ther- OW! Darn it, hit my head against the anvil there... ow. What can I do you for? ";
	} else if(greet==3) {
		cout<<"Melvin The Merchant: Hello there... do I know you? You look like that Bond fellow I met a while back. Nah, can't be. ";
	} else if(greet==4) {
		cout<<"Melvin The Merchant: One second, I'll be right out! Gosh darn hammer, can't find it anywhere... Oh, hi there. ";
	}

	cout<<"Would you like to buy something? Please simply answer yes or no, I get confuzzled easily.\n";
	getline(cin, opt);
	opt = to_lower(opt);
	while(opt != "yes" && opt != "no") {
		cout<<"Melvin The Merchant: Sorry, I must have not heard you correctly. Would you like to buy something?\n";
		getline(cin, opt);
		opt = to_lower(opt);
	}

	if(opt == "yes") {
		//If prime
		if(discount == 1) {
			cout<<"\nMelvin The Merchant: Wonderful! Let me show you what I've got. Oh, and if you're looking for weapons, then you, sir, are in luck! I've got a discount on all weapons right now!\n";
		} else if(discount == 2) {
			cout<<"\nMelvin The Merchant: Wonderful! Let me show you what I've got. Oh, and if you're looking for clothing, then you, sir, are in luck! I've got a discount on all clothing items right now!\n";
		} else if(discount == 3) {
			cout<<"\nMelvin The Merchant: Wonderful! Let me show you what I've got. Oh, and if you're looking for potions, then you, sir, are in luck! I've got a discount on all my potions right now!\n";
		} else if(discount == 4) {
			cout<<"\nMelvin The Merchant: Wonderful! Let me show you what I've got. Oh, and if you're looking for food, then you, sir, are in luck! I've got a discount on all food related items right now!\n";
		}

		while (cont == "yes" ) {
			cout<<"\nItems for sale:(1 - 4)\n\n";
			//Discount code Adelson
			cout<<"\n1. Weapons";
			if(discount==1)cout<<" (25% discount)";
			cout<<"\n2. Clothing";
			if(discount==2)cout<<" (25% discount)";
			cout<<"\n3. Potions";
			if(discount==3)cout<<" (25% discount)";
			cout<<"\n4. Food";
			if(discount==4)cout<<" (25% discount)";
			cout<<"\n\nYou have "<<gold<<" gold!\n";
			cout << "\nEnter your option here: \n";
			string menu_input;
			getline(cin, menu_input);
			if(menu_input.empty()) continue; //gpt
			menu_opt = menu_input[0];

			switch(menu_opt) {
			//Weapons
			case '1': {
				float display_price;
				cout<<"\nMelvin The Merchant: Oh, you're in the market for weapons, well you've come to the right place, here's what I got:\n\n";
				for (int i =0; i <5; i++) {
					display_price = w_prices[i];
					if(discount==1) display_price *= 0.75;
					cout<<w_names[i]<<" - "<<display_price<<" gold"<<" - "<<wstock_bought[i]<<"/"<<w_stock[i]<<" bought\n";
				}

				buying = -1;
				while (buying == -1) {
					cout<<"\nWeapons, huh? What is it you desire?: ";
					getline(cin, want);
					want = to_lower(want);
					for (int i = 0; i<5; i++) {
						if(want == w_names[i]) buying = i;
					}
					if(buying == -1) {
						cout << "Sorry, that item is not available. Please choose an item from the list.\n";
					}
				}

				cout<<"\n\nAlright! You want a "<<w_names[buying]<<". Must be some kind of warrior. How many would you like?: ";
				cin >> quantity;
				if (cin.fail() || quantity <= 0 ) {
					cin.clear();
					cin.ignore(numeric_limits<streamsize>::max(), '\n'); /*chatgpt*/
					cout<<"\nMelvin The Merchant: Um... you alright? If your looking for something free, you've come to the wrong place.\n";
					cout<<"Would you like to keep purchasing? ";
					getline(cin, cont);
					cont=to_lower(cont);
					continue;
				}
				cin.ignore(numeric_limits<streamsize>::max(), '\n'); /*chatgpt*/

				if(quantity > (w_stock[buying] - wstock_bought[buying])) {
					cout<<"Sorry man, I don't have that much.\n";
					cout<<"Would you like to keep purchasing? ";
					getline(cin, cont);
					cont=to_lower(cont);
					break;
				}

				float final_price = quantity * w_prices[buying];
				if(discount==1) final_price *= 0.75;

				//CONFIRM PURCHASE LOOP
				buy_opt = "";
				while(buy_opt != "yes" && buy_opt != "no") {
					cout<<"\nAre you sure you want to buy "<<quantity<<" "<< w_names[buying]<<" for: "<<final_price<<" gold"<<"?(yes/no): ";
					getline(cin, buy_opt);
					buy_opt = to_lower(buy_opt);
				}

				if (buy_opt == "no") {
					cout<<"\nAlright then.\n";
				} else {
					if(gold < final_price) {
						cout<<"\nWhoa there comrade! That's not enough for what you're asking!\n";
					} else {
						gold = gold - final_price;
						cout<<"You have successfully bought "<<quantity<<" "<<w_names[buying]<<" for: "<<final_price<<"!\n";
						cout<<"\nYou now have "<<gold<<" gold remaining.\n";
						wstock_bought[buying]+= quantity;
					}
				}
				cout<<"Would you like to keep purchasing? ";
				getline(cin, cont);
				cont=to_lower(cont);

			}
			break;

			//Clothing
			case '2': {
				float display_price;
				cout<<"\nMelvin The Merchant: Alright! You can never go wrong with some clothes. I got you, here's what I got:\n\n";
				for (int i =0; i <5; i++) {
					display_price = c_prices[i];
					if(discount==2) display_price *= 0.75;
					cout<<c_names[i]<<" - "<<display_price<<" gold"<<" - "<<cstock_bought[i]<<"/"<<c_stock[i]<<" bought\n" ;
				}

				buying = -1;
				while (buying == -1) {
					cout<<"\nWell then.. What will it be?: ";
					getline(cin, want);
					want = to_lower(want);
					for (int i = 0; i<5; i++) {
						if(want == c_names[i]) buying = i;
					}
					if(buying == -1) {
						cout << "Sorry, that item is not available. Please choose an item from the list.\n";
					}
				}

				cout<<"\n\nAlright! You want "<<c_names[buying]<<"(s). Getting cold out, gotta protect your body, it's a temple, you know?. How many would you like?: ";
				cin >> quantity;
				if (cin.fail() || quantity <= 0 ) {
					cin.clear();
					cin.ignore(numeric_limits<streamsize>::max(), '\n');  /*chatgpt*/
					cout<<"\nMelvin The Merchant: Um... you alright? If your looking for something free, you've come to the wrong place.\n";
					cout<<"Would you like to keep purchasing? ";
					getline(cin, cont);
					cont=to_lower(cont);
					continue;
				}
				cin.ignore(numeric_limits<streamsize>::max(), '\n');  /*chatgpt*/

				if(quantity > (c_stock[buying] - cstock_bought[buying])) {
					cout<<"Sorry man, I don't have that much.\n";
					cout<<"Would you like to keep purchasing? ";
					getline(cin, cont);
					cont=to_lower(cont);
					break;
				}

				final_price = quantity * c_prices[buying];
				if(discount==2) final_price *= 0.75;

				buy_opt = "";
				while(buy_opt != "yes" && buy_opt != "no") {
					cout<<"\nAre you sure you want to buy "<<quantity<<" "<< c_names[buying]<<" for: "<<final_price<<" gold"<<"?(yes/no): ";
					getline(cin, buy_opt);
					buy_opt = to_lower(buy_opt);
				}

				if (buy_opt == "no") {
					cout<<"\nAlright then.\n";
				} else {
					if(gold < final_price) {
						cout<<"\nWhoa there comrade! That's not enough for what you're asking!\n";
					} else {
						gold -= final_price ;
						cout<<"You have successfully bought "<<quantity<<" "<<c_names[buying]<<" for: "<<final_price<<"!\n";
						cout<<"\nYou now have "<<gold<<" gold remaining.\n";
						cstock_bought[buying]+= quantity;
					}
				}
				cout<<"Would you like to keep purchasing? ";
				getline(cin, cont);
				cont=to_lower(cont);

			}
			break;

			//Potions
			case '3': {
				float display_price;
				cout<<"\nMelvin The Merchant: Oh, you're looking for potions? Excellent choice! Here's what I currently have in stock:\n\n";
				for (int i =0; i <4; i++) {
					display_price = p_prices[i];
					if(discount==3) display_price *= 0.75;
					cout<<p_names[i]<<" - "<<display_price<<" gold"<<" - "<<pstock_bought[i]<<"/"<<p_stock[i]<<" bought\n";
				}

				buying = -1;
				while (buying == -1) {
					cout<<"\nWell then... Which potion would you like?: ";
					getline(cin, want);
					want = to_lower(want);
					for (int i = 0; i<4; i++) {
						if(want == p_names[i]) buying = i;
					}
					if(buying == -1) {
						cout << "Sorry, that item is not available. Please choose an item from the list.\n";
					}
				}

				cout<<"\n\nAlright! You want a "<<p_names[buying]<<" potion. Planning something huh? How many would you like?: ";
				cin >> quantity;
				if (cin.fail() || quantity <= 0 ) {
					cin.clear();
					cin.ignore(numeric_limits<streamsize>::max(), '\n');  /*chatgpt*/
					cout<<"\nMelvin The Merchant: Um... you alright? If your looking for something free, you've come to the wrong place.\n";
					cout<<"Would you like to keep purchasing? ";
					getline(cin, cont);
					cont=to_lower(cont);
					continue;
				}
				cin.ignore(numeric_limits<streamsize>::max(), '\n');  /*chatgpt*/

				if(quantity > (p_stock[buying] - pstock_bought[buying])) {
					cout<<"Sorry, I don't have that many.\n";
					cout<<"Would you like to keep purchasing? ";
					getline(cin, cont);
					cont=to_lower(cont);
					break;
				}

				final_price = quantity * p_prices[buying];
				if(discount==3) final_price *= 0.75;

				buy_opt = "";
				while(buy_opt != "yes" && buy_opt != "no") {
					cout<<"\nAre you sure you want to buy "<<quantity<<" "<< p_names[buying]<<" for: "<<final_price<<" gold"<<"?(yes/no): ";
					getline(cin, buy_opt);
					buy_opt = to_lower(buy_opt);
				}

				if (buy_opt == "no") {
					cout<<"\nAlright then.\n";
				} else {
					if(gold < final_price) {
						cout<<"\nWhoa there! You don't have enough gold for that.\n";
					} else {
						gold -= final_price;
						cout<<"You have successfully bought "<<quantity<<" "<<p_names[buying]<<" for: "<<final_price<<"!\n";
						cout<<"\nYou now have "<<gold<<" gold remaining.\n";
						pstock_bought[buying]+= quantity;
					}
				}
				cout<<"Would you like to keep purchasing? ";
				getline(cin, cont);
				cont=to_lower(cont);

			}
			break;

			//Food
			case '4': {
				float display_price;
				cout<<"\nMelvin The Merchant: Oh, you're looking for food? Excellent choice! Here's what I currently have in stock:\n\n";
				for (int i = 0; i < 4; i++) {
					display_price = f_prices[i];
					if(discount == 4) display_price *= 0.75;
					cout<<f_names[i]<<" - "<<display_price<<" gold - "<<fstock_bought[i]<<"/"<<f_stock[i]<<" bought\n";
				}

				buying = -1;
				while (buying == -1) {
					cout<<"\nWell then... Which food item would you like?: ";
					getline(cin, want);
					want = to_lower(want);
					for (int i = 0; i < 4; i++) {
						if (want == f_names[i]) buying = i;
					}
					if(buying == -1) {
						cout << "Sorry, that item is not available. Please choose an item from the list.\n";
					}
				}

				cout<<"\n\nAlright! You want some "<<f_names[buying]<<". You must be hungry. How many would you like?: ";
				cin >> quantity;
				if (cin.fail() || quantity <=0) {
					cin.clear();
					cin.ignore(numeric_limits<streamsize>::max(), '\n');  /*chatgpt*/
					cout<<"Melvin The Merchant: Um... you alright? If your looking for something free, you've come to the wrong place.\n";
					cout<<"Would you like to keep purchasing? ";
					getline(cin, cont);
					cont = to_lower(cont);
					continue;
				}
				cin.ignore(numeric_limits<streamsize>::max(), '\n');  /*chatgpt*/

				if (quantity > (f_stock[buying] - fstock_bought[buying])) {
					cout<<"Sorry man, I don't have that much.\n";
					cout<<"Would you like to keep purchasing? ";
					getline(cin, cont);
					cont = to_lower(cont);
					break;
				}

				final_price = quantity * f_prices[buying];
				if (discount == 4) final_price *= 0.75;

				buy_opt = "";
				while(buy_opt != "yes" && buy_opt != "no") {
					cout<<"\nAre you sure you want to buy "<<quantity<<" "<<f_names[buying]<<" for: "<<final_price<<" gold"<<"?(yes/no): ";
					getline(cin, buy_opt);
					buy_opt = to_lower(buy_opt);
				}

				if (buy_opt == "no") {
					cout<<"\nAlright then.\n";
				} else {
					if (gold < final_price) {
						cout<<"\nWhoa there comrade! That's not enough for what you're asking!\n";
					} else {
						gold -= final_price;
						cout<<"You have successfully bought "<<quantity<<" "<<f_names[buying]<<" for: "<<final_price<<"!\n";
						cout<<"\nYou now have "<<gold<<" gold remaining.\n";
						fstock_bought[buying] += quantity;
					}
				}

				cout<<"Would you like to keep purchasing? ";
				getline(cin, cont);
				cont=to_lower(cont);

			}
			break;

			default:
				cout<<"Sorry, that's not a valid menu option.\n";
				break;
			}

		}

		cout<<"\nMelvin The Merchant: Alright, thank you for coming by!\n";
	} else {
		cout<<"\nMelvin The Merchant: Aw, too bad. Maybe next time.\n";
	}

	return 0;
}
